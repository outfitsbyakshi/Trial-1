<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - Outfits By Akshi</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div>
      <h1>Outfits By Akshi</h1>
      <p>Curated By You, For You</p>
    </div>
    <nav>
      <a href="index3.html">Home</a>
      <a href="cart.html">Cart</a>
    </nav>
  </header>

  <div class="container">
    <div class="order-summary">
      <h2>Order Summary</h2>
      <div id="orderItems"></div>
      <p id="orderTotal"></p>
    </div>

    <form class="checkout-form" id="orderForm">
      <h2>Customer Information</h2>
      <input type="text" id="name" placeholder="name" required>
      <input type="email" id="email" placeholder="email" required>
      <input type="phone" id="phone" placeholder="phone" required>
      <textarea id="address" placeholder="address" required></textarea>
      <button type="submit">Submit & Pay</button>
    </form>

    <div class="success" id="successMessage">
      Redirecting you to PayPal
    </div>
  </div>

  <script>
    const orderItemsDiv = document.getElementById("orderItems");
    const orderTotalP = document.getElementById("orderTotal");
    const orderForm = document.getElementById("orderForm");
    const successMessage = document.getElementById("successMessage");

    // Get cart items
    const cartItems = JSON.parse(localStorage.getItem("cart")) || [];
    let total = 0;

    if (cartItems.length === 0) {
      orderItemsDiv.innerHTML = "<p>Your cart is empty.</p>";
      orderForm.style.display = "none";
    } else {
      cartItems.forEach(item => {
        // Ensure price is a number
        const price = parseFloat(item.price) || 0;

        orderItemsDiv.innerHTML += `
          <p>${item.name} (Size: ${item.size}) - ₹${price.toFixed(2)}</p>
        `;
        total += price;
      });
      orderTotalP.textContent = "Total: ₹" + total.toFixed(2);
    }

    // Handle form submit
    orderForm.addEventListener("submit", function(e) {
      e.preventDefault();

      const orderData = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        address: document.getElementById("address").value,
        items: cartItems.map(item => `${item.name} (Size: ${item.size}) - ₹${item.price}`).join('; '),
        total: total.toFixed(2),
        date: new Date().toLocaleString()
      };

      // Send to Google Sheets
      fetch("https://sheetdb.io/api/v1/op7hkfcpu4the", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ data: orderData })
      })
      .then(res => res.json())
      .then(() => {
        localStorage.removeItem("cart");
        document.getElementById("orderForm").style.display = "none";
        document.getElementById("successMessage").style.display = "block";

        // Redirect to PayPal.Me with amount
        setTimeout(() => {
          window.location.href = "paypal.me/Lekhakshi" + orderData.total;
        }, 2000);
      })
      .catch(err => {
        alert("⚠️ Error while placing order! Please try again.");
        console.error(err);
      });
    });
  </script>
</body>
</html>
